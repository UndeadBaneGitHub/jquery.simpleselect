/* jquery.simpleselect
-- version 0.1.1
-- copyright 2014 UndeadBane*2014
-- licensed under the MIT
--
-- https://github.com/UndeadBaneGitHub/jquery.simpleselect
--
*/
(function($){var _SimpleSelect=function(t,n,r){var i=function(e){var t=new Array;$(e).find("option").each(function(){t.push(this.innerText)});return t};var s=t instanceof $?t[0]:t;var o=Object.prototype.toString.call(n)==="[object Array]"?n:i(n);var u={preserveElementMargin:false,wrapperMaxWidth:"css",wrapperMaxHeight:"css",wrapperWidth:"css",wrapperHeight:"css",wrapperMinWidth:"element",wrapperMinHeight:"element",itemFont:"element",useEscapedElementText:false,openEvent:"click",searchEvent:"keyup",niceScrollOptions:{cursorwidth:9,cursoropacitymax:.8},emptyListItemContent:"Совпадений не найдено",forceValueToListValue:true,placeholderValue:"",placeholderStyle:{color:"lightgray"},scrollIntoViewIfNeeded:true,preventClosingOnSelect:false,doNotSelectOnClicksTo:"",drawArrow:true};var a=null;var f=this;var l=null,c=null,h=false,p=false,d=1;var v=function(e){var t=s;var n={top:t.offsetTop+$(t).outerHeight(),left:$(t).position().left};for(var r=1;r<e;r++){t=t.parentNode;if(/BODY|HTML/.test(t.nodeName)){break}n.top+=t.offsetTop;n.left+=t.offsetLeft}return n};var m=function(e){var t=$(e).clone(false);t.css({visibility:"hidden",position:"absolute"});t.appendTo("body");var n={height:t.outerHeight(),width:t.outerWidth()};t.remove();return n};var g=function(e,t){var n=function(e,t,r,i,s,o,u){var a=1;var f=t?-1:1,c=t?0:1,h=t?1:0;if(!r){var p=parseFloat($(l).css("height")||$(l).css("max-height")),d=parseFloat($(l).css("width")||$(l).css("max-width"));if(!p||!d){var v=m(l);p=v.height;d=v.width}if(!p||!d){return 0}var g={top:$(e).offset().top+c*$(e).outerHeight(),left:$(e).offset().left,bottom:$(e).offset().top+c*$(e).outerHeight()+f*p,right:$(e).offset().left+d}}else{g=r}if(/BODY|HTML/.test(e.nodeName)){return a}var y=e.parentNode;if(!$(y).isScrollable()&&g.bottom>$(y).offset().top+$(y).height()){a+=n(y,t,g,w,x,T,C)}else{var b=10;var w=i?i:g.top+f*b,E=g.top,S=null;var x=s||null,T=o||null;T=e;var N=false;while(!(N=$(T=T.parentNode).isScrollable("y"))&&!/HTML/.test(T.nodeName));if(!N){return a}x=$(T).offset().top+c*$(T).height()-f*b;var C=u||false;while(f*w<f*g.bottom){if(f*w>f*x&&!C){$(T).scrollTop($(T).scrollTop()+(w-x));C=true}S=document.elementFromPoint((g.right+g.left)/2,C?x:w);if(!S){return a}if(S===y){w+=f*b;if(C){$(T).scrollTop($(T).scrollTop()+f*b)}continue}if(S.parentNode===y.parentNode){a+=n(y,t,g,w,x,T,C);break}w+=f*b;if(C){$(T).scrollTop($(T).scrollTop()+f*b)}}}return a};return n(e,t)};this.open=function(){if(h){return}w();var e=this;var t=this.getItemsWrapper();var n=false;var r=this.getElementText();$(s).data({oldText:r});p=t.id?$("#"+t.id).get(0)===t:false;if(!p){t.id="simple-select-items-wrapper-"+x();$(t).css({position:"absolute",maxWidth:this.getDimensionValue(s,"max-width"),width:this.getDimensionValue(s,"width"),minWidth:this.getDimensionValue(s,"min-width"),maxHeight:this.getDimensionValue(s,"max-height"),height:this.getDimensionValue(s,"height"),minHeight:this.getDimensionValue(s,"min-height")});var i=g(s);if(!i){throw new Error("Failed to find insertion level!")}var o=s.parentNode;for(var a=1;a<i;a++){o=o.parentNode}var l=v(i);if(u.preserveElementMargin){var c=parseFloat($(s).css("margin-bottom"));l.top+=c}$(t).css({top:l.top,left:l.left});$(o).append(t);this.setScroll()}else{t.style.display=""}if(r){$(t).children().each(function(e){var t=f.getElementText(this);if(t===r){if(!$(this).hasClass("hovered")){$(this).addClass("hovered")}$(this).scrollIntoViewIfNeeded()}else if($(this).hasClass("hovered")){$(this).removeClass("hovered")}})}if(u.scrollIntoViewIfNeeded){$(t).scrollIntoViewIfNeeded()}this.updateScroll(!p);h=true;$(s).focus();E(s,this.getElementText().length,this.getElementText().length);k();$(s).trigger("simple-select-post-open")};this.close=function(e){if(!h){return}var t=false;var n=this;var r=this.getItemsWrapper();if(e){this.setElementText($(s).data("oldText"));$(s).trigger("simple-select-input-canceled")}else{$(s).data("oldText",this.getElementText())}var i=this.getElementText();if(!i){b()}if(i){$(r).children().each(function(e){var n=f.getElementText(this);if(n===i){t=true;if(!$(this).hasClass("hovered")){$(this).addClass("hovered")}$(this).scrollIntoViewIfNeeded()}else if($(this).hasClass("hovered")){$(this).removeClass("hovered")}})}if(u.forceValueToListValue&&i&&!t){return}this.getItemsWrapper().style.display="none";this.updateScroll();h=false;C();$(s).trigger("simple-select-post-close");if(i){$(s).trigger("simple-select-selected")}};this.search=function(e){w();var t=this;var n=this.getItemsWrapper();var r=e?e:this.getElementText();if($(n).children(".hovered").length&&r){return}$(n).children(".hovered").removeClass("hovered");$(n).children().each(function(e){$(this).removeHighlight();$(this).highlight(r,{caseSensitive:false});if(!$(this).find(".highlight").length&&r){this.style.display="none"}else{this.style.display=""}});this.updateScroll();$(s).trigger("simple-select-post-search")};this.isOpen=function(){return h};this.getDimensionValue=function(e,t){var n="";var r=null;switch(t){case"max-width":n=u.wrapperMaxWidth;r=e.scrollWidth+parseFloat($(e).css("borderLeftWidth"))+parseFloat($(e).css("borderRightWidth"));break;case"width":n=u.wrapperWidth;r=e.scrollWidth+parseFloat($(e).css("borderLeftWidth"))+parseFloat($(e).css("borderRightWidth"));break;case"min-width":n=u.wrapperMinWidth;r=e.scrollWidth+parseFloat($(e).css("borderLeftWidth"))+parseFloat($(e).css("borderRightWidth"));break;case"max-height":n=u.wrapperMaxHeight;r=e.scrollHeight+parseFloat($(e).css("borderTopWidth"))+parseFloat($(e).css("borderBottomWidth"));break;case"height":n=u.wrapperHeight;r=e.scrollHeight+parseFloat($(e).css("borderTopWidth"))+parseFloat($(e).css("borderBottomWidth"));break;case"min-height":n=u.wrapperMinHeight;r=e.scrollHeight+parseFloat($(e).css("borderTopWidth"))+parseFloat($(e).css("borderBottomWidth"));break}switch(n){case"css":return"";break;case"element":var i=r?r:$(e).css(t);return i;break;default:return n}};this.setItems=function(e){o=Object.prototype.toString.call(e)==="[object Array]"?e:i(e);y();f.updateScroll()};var y=function(){$(l).children(".simple-select-item").not(".empty-list-item").remove();for(var e=0;e<o.length;e++){var t=document.createElement("div");t.className="simple-select-item";t.id="simple-select-item-"+e;t.innerHTML=o[e];if(u.itemFont==="element"){$(t).css({font:$(s).css("font")})}$(l).append(t);$(t).click(function(e){if($(e.target).not(u.doNotSelectOnClicksTo).length===0){return}e.preventDefault();w();$(this).removeHighlight();var t=f.getElementText(this);f.setElementText(t);if(!u.preventClosingOnSelect){f.close()}return false});$(t).hover(function(e){var t=$(this).siblings(".hovered");t.toggleClass("hovered");$(this).parent().data({isHovered:true})})}};this.getItemsWrapper=function(){if(!l){l=document.createElement("div");l.className="simple-select-items-wrapper";l.id=null;c=document.createElement("div");c.className="simple-select-item empty-list-item";c.id="simple-select-item empty-list-item";c.innerHTML=u.emptyListItemContent;$(l).append(c);c.style.display="none";y();d=Math.max(d,S(l));$(l).hover(function(){$(this).data({isHovered:true})});$(l).mouseout(function(t){e=t.toElement||t.relatedTarget;var n=e;for(var r=0;r<d;r++){if(!n){return}if(n===this){return}n=n.parentNode}$(this).data({isHovered:false})})}return l};this.getElementText=function(e){w();var t=e?e:s;if(typeof t["simpleSelectToString"]==="function"){return t["simpleSelectToString"]()}else{return t.nodeName==="input"||t.nodeName==="textarea"?$(t).val():(u.useEscapedElementText?$(t).html():$(t).text()).replace(/(&nbsp)/g," ")}};this.setElementText=function(e,t,n){var r=n?n:s;if(typeof r["simpleSelectFromString"]==="function"){r["simpleSelectFromString"](e);return}else{r.nodeName==="input"||r.nodeName==="textarea"?$(r).val(e):u.useEscapedElementText?$(r).html(e):$(r).text(e)}if(!e&&!t){b()}else{E(r,e.length,e.length)}};this.setScroll=function(){currentItemsWrapper=this.getItemsWrapper();if(typeof $(currentItemsWrapper).niceScroll==="function"){currentItemsWrapper.style.overflowY="hidden";$(currentItemsWrapper).niceScroll(u.niceScrollOptions)}else{$(currentItemsWrapper).style.overflowY="scroll"}};this.updateScroll=function(e){if(!e){if(typeof $(this.getItemsWrapper()).niceScroll==="function"){if(this.isOpen()){$(this.getItemsWrapper()).getNiceScroll().show();$(this.getItemsWrapper()).getNiceScroll().resize()}else{$(this.getItemsWrapper()).hide()}}}if(!$(this.getItemsWrapper()).children(".simple-select-item:visible").not(".empty-list-item").length){c.style.display=""}else{c.style.display="none"}};var b=function(e){if(!u.placeholderValue){return}var t=e?e:s;if(!f.getElementText(t)){$(t).data("hasPlaceholder",true);f.setElementText(u.placeholderValue,true,t);for(prop in u.placeholderStyle){t.style[prop]=u.placeholderStyle[prop]}$(t).focusin(w)}};var w=function(e){if(!u.placeholderValue){return}var t=e?e:s;if($(t).data("hasPlaceholder")){$(t).data("hasPlaceholder",false);f.setElementText("",true,t);for(prop in u.placeholderStyle){t.style[prop]=""}}};var E=function(e,t,n){if(!e.firstChild){return}var r=document.createRange();r.setStart(e.firstChild,t);r.setEnd(e.firstChild,n);var i=window.getSelection();i.removeAllRanges();i.addRange(r)};var S=function(e){var t=e.firstChild;var n=[];if(!t){return 0}while(t){n.push(S(t));t=t.nextSibling}return Math.max.apply(Math,n)+1};var x=function(){var e=0;while($("#simple-select-items-wrapper-"+e).length){e++}return e};var T=function(){if(u.drawArrow){a=document.createElement("div");a.className="simple-select-arrow";a.innerText="▼";$(s).css("padding-right","14px");var e=s;var t={top:0,left:$(e).outerWidth()-12};while($(e).css("position")!=="absolute"&&$(e).css("position")!=="relative"&&!/BODY|HTML/.test(e.nodeName)){t.top+=e.offsetTop;t.left+=e.offsetLeft;e=e.parentNode}$(a).css({height:$(s).height(),top:t.top,right:t.right,left:t.left});$(e).append(a);var n=function(e){e.preventDefault();e.target=s;$(s).trigger(e);return false};$(a).off(u.openEvent,n);$(a).on(u.openEvent,n)}};var N=function(){if(a){$(a).remove()}};var C=function(){if(a){a.innerText="▼";$(a).css({top:parseFloat($(a).css("top"))+1})}$(a).css("line-height","")};var k=function(){if(a){a.innerText="▲";$(a).css({top:parseFloat($(a).css("top"))-1})}};var L=function(e){if(!f.isOpen()){return}if(!$(e.target).closest($(s)).length&&!$(e.target).closest($(f.getItemsWrapper())).length){f.close()}};var A=function(){if(r){for(var e in u){if(typeof u[e]!="undefined"&&typeof r[e]!="undefined"){u[e]=r[e]}}}$(s).off("keydown",_element_keydown);$(s).on("keydown",_element_keydown);$(s).off(u.openEvent,_openEvent_happened);$(s).on(u.openEvent,_openEvent_happened);if(u.searchEvent){$(s).off(u.searchEvent,_searchEvent_happened);$(s).on(u.searchEvent,_searchEvent_happened)}$(document).off("click",L);$(document).on("click",L);T();b()};this.removeSimpleSelect=function(){if(this.isOpen()){this.close()}if(typeof $(this.getItemsWrapper()).getNiceScroll==="function"){if($(this.getItemsWrapper()).getNiceScroll().length){$(this.getItemsWrapper()).getNiceScroll().remove()}}$(s).off("keydown",_element_keydown);$(s).off(u.openEvent,_openEvent_happened);if(u.searchEvent){$(s).off(u.searchEvent,_searchEvent_happened)}$(this.getItemsWrapper()).remove();$(document).off("click",L);N();$(s).data("simpleSelect",null)};A()};var _openEvent_happened=function(e){var t=$(this).data("simpleSelect");if(!t){return}if(!t.isOpen()){t.open()}else{t.close()}};var _searchEvent_happened=function(e){$(this).data("simpleSelect").search()};var _element_keydown=function(e){var t=$(this).data("simpleSelect");var n=t.getItemsWrapper();var r=t.isOpen();if(!r){t.open()}var i=$(n).children().not(".empty-list-item").not(":hidden");var s=i.siblings(".hovered").get(0)||null;switch(e.which){case 10:case 13:case 27:e.preventDefault();if(typeof e.stopPropagation==="function"){e.stopPropagation()}t.close(e.which===27);break;case 38:case 40:if($(n).data("isHovered")){t.setElementText("",true);return false}if(!r){return false}e.preventDefault();if(typeof e.stopPropagation==="function"){e.stopPropagation()}i=$(n).children().not(".empty-list-item").not(":hidden");s=i.siblings(".hovered").get(0)||null;if(e.which===38){if(s){$(s).removeClass("hovered");s=s.previousSibling;while(s&&!$(s).is(":visible")&&!$(s).is(".empty-list.item")){s=s.previousSibling}}if(!s){s=i.last().get(0)}}else{if(s){$(s).removeClass("hovered");s=s.nextSibling;while(s&&!$(s).is(":visible")&&!$(s).is(".empty-list.item")){s=s.nextSibling}}if(!s){s=i.first().get(0)}}if(s){$(s).removeHighlight();if(!$(s).hasClass("hovered")){$(s).addClass("hovered")}t.setElementText(t.getElementText(s));$(s).scrollIntoViewIfNeeded()}else{t.setElementText("")}break;default:if(s){$(s).removeClass("hovered")}return}};$.fn.makeSimpleSelect=function(e,t){return this.each(function(){var n=$(this);if(n.data("simpleSelect"))return;var r=new _SimpleSelect(this,e,t);n.data("simpleSelect",r)})};$.fn.removeSimpleSelect=function(){return this.each(function(){var e=$(this);var t=e.data("simpleSelect");if(!t){return}t.removeSimpleSelect()})};if(typeof $.fn.scrollIntoViewIfNeeded!=="function"){$.fn.scrollIntoViewIfNeeded=function(e){return this.each(function(){if(typeof this.scrollIntoViewIfNeeded!=="function"){var t=this,n=this.parentNode.getBoundingClientRect(),r=t.getBoundingClientRect();var i=null;if(r.top<n.top&&!e){i=true}if(r.bottom>n.bottom&&!e){i=false}if(r.top<n.top||r.bottom>n.bottom||r.right>n.right||r.left<n.left)t.scrollIntoView(i)}else{this.scrollIntoViewIfNeeded(typeof e==="bool"?e:null)}})}}if(typeof $.fn.highlight!=="function"){jQuery.fn.highlight=function(e){function t(e,n){var r=0;if(e.nodeType==3){var i=e.data.toUpperCase().indexOf(n);if(i>=0){var s=document.createElement("span");s.className="highlight";var o=e.splitText(i);var u=o.splitText(n.length);var a=o.cloneNode(true);s.appendChild(a);o.parentNode.replaceChild(s,o);r=1}}else if(e.nodeType==1&&e.childNodes&&!/(script|style)/i.test(e.tagName)){for(var f=0;f<e.childNodes.length;++f){f+=t(e.childNodes[f],n)}}return r}return this.length&&e&&e.length?this.each(function(){t(this,e.toUpperCase())}):this}}if(typeof $.fn.removeHighlight!=="function"){jQuery.fn.removeHighlight=function(){return this.find("span.highlight").each(function(){this.parentNode.firstChild.nodeName;with(this.parentNode){replaceChild(this.firstChild,this);normalize()}}).end()}}$.fn.isScrollable=function(e){var t=new Array;this.each(function(n,r){var i,s;var o=e==="vertical"||e==="y"||!e,u=e==="horizontal"||e==="x";if($(r).getNiceScroll().length){if(u&&$(r).getNiceScroll().opt.horizrailenabled){return true}if(o){return true}}if($(r).css("overflow")=="scroll"||$(r).css("overflowX")==="scroll"&&(u||!e)||$(r).css("overflowY")==="scroll"&&(o||!e)){t.push(true);return}if(o||!e){i=r.clientHeight<r.scrollHeight&&($.inArray($(r).css("overflowY"),["scroll","auto"])!==-1||$.inArray($(r).css("overflow"),["scroll","auto"])!==-1);if(!e){if(i){t.push(true);return}}else{t.push(i);return}}if(u||!e){s=r.clientWidth<r.scrollWidth&&($.inArray($(r).css("overflowX"),["scroll","auto"])!==-1||$.inArray($(r).css("overflow"),["scroll","auto"])!==-1);t.push(s)}});if(t.length===1){return t[0]}else{return t}}})(jQuery)
