/* jquery.simpleselect
-- version 0.1.1
-- copyright 2014 UndeadBane*2014
-- licensed under the MIT
--
-- https://github.com/UndeadBaneGitHub/jquery.simpleselect
--
*/
(function($){var _SimpleSelect=function(t,n,r){var i=function(e){var t=new Array;$(e).find("option").each(function(){t.push(this.innerText)});return t};var s=t instanceof $?t[0]:t;var o=Object.prototype.toString.call(n)==="[object Array]"?n:i(n);var u={preserveElementMargin:false,wrapperMaxWidth:"css",wrapperMaxHeight:"css",wrapperWidth:"css",wrapperHeight:"css",wrapperMinWidth:"element",wrapperMinHeight:"element",itemFont:"element",useEscapedElementText:false,openEvent:"click",searchEvent:"keyup",emptyListItemContent:"Совпадений не найдено",forceValueToListValue:true,placeholderValue:"",placeholderStyle:{color:"lightgray"},scrollIntoViewIfNeeded:true,preventClosingOnSelect:false,doNotSelectOnClicksTo:"",drawArrow:true,drawPosition:"bottom left",doNotModifyElementText:false,itemGetElementTextFunction:null,itemSetElementTextFunction:null,openOnSearch:false,updatePositionOnOpen:false};var a=null;var f=this;var l=null,c=null,h=false,p=false,d=1;var v=function(e){var t=s;var n={top:t.offsetTop+$(t).outerHeight(),left:$(t).position().left};var r=parseFloat($(l).css("height")||$(l).css("max-height")),i=parseFloat($(l).css("width")||$(l).css("max-width"));if(!r||!i){var o=m(l);r=o.height;i=o.width}if(!r||!i){return 0}if(u.drawPosition.indexOf(" right")!==-1){n.left-=i-$(t).outerWidth()}if(u.drawPosition.indexOf("right")===0){n.top-=$(t).outerHeight();n.left+=$(t).outerWidth()}for(var a=1;a<e;a++){t=t.parentNode;if(/BODY|HTML/.test(t.nodeName)){break}n.top+=t.offsetTop;n.left+=t.offsetLeft}return n};var m=function(e){var t=$(e).clone(false);t.css({visibility:"hidden",position:"absolute"});t.appendTo("body");var n={height:t.outerHeight(),width:t.outerWidth()};t.remove();return n};var g=function(e,t,n,r){if(u.drawPosition.indexOf(" right")!==-1){r.left-=t-$(e).outerWidth();r.right-=t-$(e).outerWidth();return}if(u.drawPosition.indexOf("right")===0){r.top-=$(e).outerHeight();r.bottom-=$(e).outerHeight();r.left+=$(e).outerWidth();r.right+=$(e).outerWidth()}};var y=function(e,t){var n=function(e,t,r,i,s,o,a){var f=1;var c=t?-1:1,h=t?0:1,p=t?1:0;if(!r){var d=parseFloat($(l).css("height")||$(l).css("max-height")),v=parseFloat($(l).css("width")||$(l).css("max-width"));if(!d||!v){var y=m(l);d=y.height;v=y.width}if(!d||!v){return 0}var b={top:$(e).offset().top+h*$(e).outerHeight(),left:$(e).offset().left,bottom:$(e).offset().top+h*$(e).outerHeight()+c*d,right:$(e).offset().left+v};g(e,v,d,b)}else{b=r}if(/BODY|HTML/.test(e.nodeName)){return f}var w=e.parentNode;var E=0;if(u.drawPosition.indexOf("right")===0){E=b.right}else if(u.drawPosition.indexOf("bottom right")===0){E=b.left}else if(u.drawPosition.indexOf("bottom left")===0){E=b.right}else{E=(b.right+b.left)/2}var S=b.bottom>$(w).offset().top+$(w).height(),x=E>$(w).offset().left+$(w).width();if(S){scrollableY=$(w).isScrollable("y")}if(x){scrollableX=$(w).isScrollable("x")}if(S&&!scrollableY||x&&!scrollableX){f+=n(w,t,b,N,L,A,M)}else{var T=10;var N=i?i:b.top+c*T,C=b.top,k=null;var L=s||null,A=o||null;A=e;var O=$(A).isScrollable("y");if(!O){while(!(O=$(A=A.parentNode).isScrollable("y"))&&!/HTML/.test(A.nodeName));}if(!O){return f}L=$(A).offset().top+h*$(A).height()-c*T;var M=a||false;while(c*N<c*b.bottom){if(c*N>c*L&&!M){$(A).scrollTop($(A).scrollTop()+(N-L));M=true}k=document.elementFromPoint(E,M?L:N);if(!k){return f}if(k===w){N+=c*T;if(M){$(A).scrollTop($(A).scrollTop()+c*T)}continue}if(k.parentNode===w.parentNode){f+=n(w,t,b,N,L,A,M);break}N+=c*T;if(M){$(A).scrollTop($(A).scrollTop()+c*T)}}}return f};return n(e,t)};var b=function(e){var t=y(s);if(!t){throw new Error("Failed to find insertion level!")}e.insertionLevel=t;E(e)};var w=function(e){var t=y(s);if(!t){throw new Error("Failed to find insertion level!")}if(t!==e.insertionLevel){e.insertionLevel=t;E(e)}};var E=function(e){var t=s.parentNode;for(var n=1;n<e.insertionLevel;n++){t=t.parentNode}var r=v(e.insertionLevel);if(u.preserveElementMargin){var i=parseFloat($(s).css("margin-bottom"));r.top+=i}$(e).css({top:r.top,left:r.left});$(t).append(e);e.style.display="none";h=false};this.open=function(){if(h){return}var e=this;var t=this.getItemsWrapper();var n=false;var r=this.getElementText();s.oldText=r;p=t.id?$("#"+t.id).get(0)===t:false;if(!p){t.id="simple-select-items-wrapper-"+L();$(t).css({position:"absolute",maxWidth:this.getDimensionValue(s,"max-width"),width:this.getDimensionValue(s,"width"),minWidth:this.getDimensionValue(s,"min-width"),maxHeight:this.getDimensionValue(s,"max-height"),height:this.getDimensionValue(s,"height"),minHeight:this.getDimensionValue(s,"min-height")});b(t);t.style.display="";this.setScroll()}else{t.style.display="";if(u.updatePositionOnOpen){w(t)}}if(r){$(t).children().each(function(e){var t=f.getElementText(this);if(t===r){if(!$(this).hasClass("hovered")){$(this).addClass("hovered")}$(this).scrollIntoViewIfNeeded()}else if($(this).hasClass("hovered")){$(this).removeClass("hovered")}})}if(u.scrollIntoViewIfNeeded){$(t).scrollIntoViewIfNeeded()}h=true;this.updateScroll(!p);if(!u.doNotModifyElementText){$(s).focus()}else{$(t).focus()}C(s,this.getElementText().length,this.getElementText().length);_();$(s).trigger("simple-select-post-open")};this.close=function(e){if(!h){return}var t=false;var n=this;var r=this.getItemsWrapper();if(e){this.setElementText(s.oldText);$(s).trigger("simple-select-input-canceled")}var i=this.getElementText();if(!i){x()}if(i){$(r).children().each(function(e){var n=f.getElementText(this);if(n===i){t=true;if(!$(this).hasClass("hovered")){$(this).addClass("hovered")}$(this).scrollIntoViewIfNeeded()}else if($(this).hasClass("hovered")){$(this).removeClass("hovered")}})}if(u.forceValueToListValue&&!u.doNotModifyElementText&&i&&!t&&i!==u.placeholderValue){return}this.getItemsWrapper().style.display="none";this.updateScroll();h=false;M();$(s).trigger("simple-select-post-close");if(i){$(s).trigger("simple-select-selected")}s.oldText=this.getElementText()};this.search=function(e){if(!h){if(!u.openOnSearch){return}else{this.open()}}T();var t=this;var n=this.getItemsWrapper();var r=e?e:this.getElementText();if($(n).children(".hovered").length&&r){return}$(n).children(".hovered").removeClass("hovered");$(n).children().each(function(e){$(this).removeHighlight();$(this).highlight(r,{caseSensitive:false});if(!$(this).find(".highlight").length&&r){this.style.display="none"}else{this.style.display=""}});this.updateScroll();$(s).trigger("simple-select-post-search")};this.isOpen=function(){return h};this.getDimensionValue=function(e,t){var n="";var r=null;switch(t){case"max-width":n=u.wrapperMaxWidth;r=e.scrollWidth+parseFloat($(e).css("borderLeftWidth"))+parseFloat($(e).css("borderRightWidth"));break;case"width":n=u.wrapperWidth;r=e.scrollWidth+parseFloat($(e).css("borderLeftWidth"))+parseFloat($(e).css("borderRightWidth"));break;case"min-width":n=u.wrapperMinWidth;r=e.scrollWidth+parseFloat($(e).css("borderLeftWidth"))+parseFloat($(e).css("borderRightWidth"));break;case"max-height":n=u.wrapperMaxHeight;r=e.scrollHeight+parseFloat($(e).css("borderTopWidth"))+parseFloat($(e).css("borderBottomWidth"));break;case"height":n=u.wrapperHeight;r=e.scrollHeight+parseFloat($(e).css("borderTopWidth"))+parseFloat($(e).css("borderBottomWidth"));break;case"min-height":n=u.wrapperMinHeight;r=e.scrollHeight+parseFloat($(e).css("borderTopWidth"))+parseFloat($(e).css("borderBottomWidth"));break}switch(n){case"css":return"";break;case"element":var i=r?r:$(e).css(t);return i;break;default:return n}};this.setItems=function(e){o=Object.prototype.toString.call(e)==="[object Array]"?e:i(e);var t=f.getItemsWrapper();S();w(t);f.updateScroll()};var S=function(){$(l).children(".simple-select-item").not(".empty-list-item").remove();for(var e=0;e<o.length;e++){var t=document.createElement("div");t.className="simple-select-item";t.id="simple-select-item-"+e;if(o[e].nodeType===1){t.appendChild(o[e])}else{t.innerHTML=o[e]}if(u.itemFont==="element"){$(t).css({font:$(s).css("font"),fontFamily:$(s).css("font-family"),fontSize:$(s).css("font-size"),fontStyle:$(s).css("font-style"),fontWeight:$(s).css("font-weight")})}t.simpleSelect_ToString=u.itemGetElementTextFunction;t.simpleSelect_FromString=u.itemSetElementTextFunction;$(l).append(t);$(t).click(function(e){if($(e.target).not(u.doNotSelectOnClicksTo).length===0){return}e.preventDefault();T();$(this).removeHighlight();var t=f.getElementText(this);f.setElementText(t);if(!u.preventClosingOnSelect){f.close()}return false});$(t).hover(function(e){var t=$(this).siblings(".hovered");t.toggleClass("hovered");$(this).parent().data({isHovered:true})})}};this.getItemsWrapper=function(){if(!l){l=document.createElement("div");l.className="simple-select-items-wrapper";l.id=null;c=document.createElement("div");c.className="simple-select-item empty-list-item";c.id="simple-select-item empty-list-item";c.innerHTML=u.emptyListItemContent;$(l).append(c);c.style.display="none";S();d=Math.max(d,k(l));$(l).hover(function(){$(this).data({isHovered:true})});$(l).mouseout(function(t){e=t.toElement||t.relatedTarget;var n=e;for(var r=0;r<d;r++){if(!n){return}if(n===this){return}n=n.parentNode}$(this).data({isHovered:false})})}return l};this.getElementText=function(e){if(u.doNotModifyElementText){return""}var t=e?e:s;if(typeof t["simpleSelect_ToString"]==="function"){var n=t["simpleSelect_ToString"].call(t)}else{var n=t.nodeName==="input"||t.nodeName==="textarea"?$(t).val():(u.useEscapedElementText?$(t).html():$(t).text()).replace(/(&nbsp)/g," ")}if(n){return N(n.trim())}else{return N(n)}};this.setElementText=function(e,t,n){if(u.doNotModifyElementText){return}var r=e.trim();var i=n?n:s;if(typeof i["simpleSelect_FromString"]==="function"){i["simpleSelect_FromString"].call(i,r);return}else{i.nodeName==="input"||i.nodeName==="textarea"?$(i).val(r):u.useEscapedElementText?$(i).html(r):$(i).text(r)}if(!r&&!t){x()}else{C(i,r.length,r.length)}};this.setScroll=function(){currentItemsWrapper=this.getItemsWrapper();currentItemsWrapper.style.overflowY="auto"};this.updateScroll=function(e){if(!$(this.getItemsWrapper()).children(".simple-select-item:visible").not(".empty-list-item").length){c.style.display=""}else{c.style.display="none"}};var x=function(e){if(!u.placeholderValue){return}var t=e?e:s;if(!f.getElementText(t)){$(t).data("hasPlaceholder",true);f.setElementText(u.placeholderValue,true,t);for(prop in u.placeholderStyle){t.style[prop]=u.placeholderStyle[prop]}$(t).focusin(T)}};var T=function(e){if(!$(e).text()){return}if(!u.placeholderValue){return}var t=e?e:s;if($(t).data("hasPlaceholder")){$(t).data("hasPlaceholder",false);f.setElementText("",true,t);for(prop in u.placeholderStyle){t.style[prop]=""}}};var N=function(e,t){if(!e){return}if(!u.placeholderValue){return}var n=t?t:s;if($(n).data("hasPlaceholder")){return e.replace(u.placeholderValue,"")}return e};var C=function(e,t,n){if(!e.firstChild){return}var r=document.createRange();r.setStart(e.firstChild,t);r.setEnd(e.firstChild,n);var i=window.getSelection();i.removeAllRanges();i.addRange(r)};var k=function(e){var t=e.firstChild;var n=[];if(!t){return 0}while(t){n.push(k(t));t=t.nextSibling}return Math.max.apply(Math,n)+1};var L=function(){var e=0;while($("#simple-select-items-wrapper-"+e).length){e++}return e};var A=function(){if(u.drawArrow){a=document.createElement("div");a.className="simple-select-arrow";a.innerText="▼";$(s).css("padding-right","14px");var e=s;var t={top:0,left:$(e).outerWidth()-12};while($(e).css("position")!=="absolute"&&$(e).css("position")!=="relative"&&!/BODY|HTML/.test(e.nodeName)){t.top+=e.offsetTop;t.left+=e.offsetLeft;e=e.parentNode}$(a).css({height:$(s).height(),top:t.top,right:t.right,left:t.left});$(e).append(a);var n=function(e){e.preventDefault();e.target=s;$(s).trigger(e);return false};$(a).off(u.openEvent,n);$(a).on(u.openEvent,n)}};var O=function(){if(a){$(a).remove()}};var M=function(){if(a){a.innerText="▼";$(a).css({top:parseFloat($(a).css("top"))+1})}$(a).css("line-height","")};var _=function(){if(a){a.innerText="▲";$(a).css({top:parseFloat($(a).css("top"))-1})}};var D=function(e){if(!f.isOpen()){return}if(!$(e.target).closest($(s)).length&&!$(e.target).closest($(f.getItemsWrapper())).length){f.close()}};var P=function(){if(r){for(var e in u){if(typeof u[e]!="undefined"&&typeof r[e]!="undefined"){u[e]=r[e]}}}$(s).off("keydown",_element_keydown);$(s).on("keydown",_element_keydown);$(s).off(u.openEvent,_openEvent_happened);$(s).on(u.openEvent,_openEvent_happened);if(u.searchEvent){$(s).off(u.searchEvent,_searchEvent_happened);$(s).on(u.searchEvent,_searchEvent_happened)}$(document).off("click",D);$(document).on("click",D);A();x()};this.removeSimpleSelect=function(){if(this.isOpen()){this.close()}$(s).off("keydown",_element_keydown);$(s).off(u.openEvent,_openEvent_happened);if(u.searchEvent){$(s).off(u.searchEvent,_searchEvent_happened)}if(l){l.parentNode.removeChild(l)}$(document).off("click",D);O();$(s).data("simpleSelect",null)};P()};var _openEvent_happened=function(e){var t=$(this).data("simpleSelect");if(!t){return}if(!t.isOpen()){t.open()}else{t.close()}};var _searchEvent_happened=function(e){$(this).data("simpleSelect").search()};var _element_keydown=function(e){var t=$(this).data("simpleSelect");var n=t.getItemsWrapper();var r=t.isOpen();if(!r){t.open()}var i=$(n).children().not(".empty-list-item").not(":hidden");var s=i.siblings(".hovered").get(0)||null;switch(e.which){case 10:case 13:case 27:e.preventDefault();if(typeof e.stopPropagation==="function"){e.stopPropagation()}t.close(e.which===27);break;case 38:case 40:if($(n).data("isHovered")){t.setElementText("",true);return false}if(!r){return false}e.preventDefault();if(typeof e.stopPropagation==="function"){e.stopPropagation()}i=$(n).children().not(".empty-list-item").not(":hidden");s=i.siblings(".hovered").get(0)||null;if(e.which===38){if(s){$(s).removeClass("hovered");s=s.previousSibling;while(s&&!$(s).is(":visible")&&!$(s).is(".empty-list.item")){s=s.previousSibling}}if(!s){s=i.last().get(0)}}else{if(s){$(s).removeClass("hovered");s=s.nextSibling;while(s&&!$(s).is(":visible")&&!$(s).is(".empty-list.item")){s=s.nextSibling}}if(!s){s=i.first().get(0)}}if(s){$(s).removeHighlight();if(!$(s).hasClass("hovered")){$(s).addClass("hovered")}t.setElementText(t.getElementText(s));$(s).scrollIntoViewIfNeeded()}else{t.setElementText("")}break;default:if(s){$(s).removeClass("hovered")}return}};$.fn.makeSimpleSelect=function(e,t){return this.each(function(){var n=$(this);if(n.data("simpleSelect"))return;var r=new _SimpleSelect(this,e,t);n.data("simpleSelect",r)})};$.fn.removeSimpleSelect=function(){return this.each(function(){var e=$(this);var t=e.data("simpleSelect");if(!t){return}t.removeSimpleSelect()})};if(typeof $.fn.scrollIntoViewIfNeeded!=="function"){$.fn.scrollIntoViewIfNeeded=function(e){return this.each(function(){if(typeof this.scrollIntoViewIfNeeded!=="function"){var t=this,n=this.parentNode.getBoundingClientRect(),r=t.getBoundingClientRect();var i=null;if(r.top<n.top&&!e){i=true}if(r.bottom>n.bottom&&!e){i=false}if(r.top<n.top||r.bottom>n.bottom||r.right>n.right||r.left<n.left)t.scrollIntoView(i)}else{this.scrollIntoViewIfNeeded(typeof e==="bool"?e:null)}})}}if(typeof $.fn.highlight!=="function"){jQuery.fn.highlight=function(e){function t(e,n){var r=0;if(e.nodeType==3){var i=e.data.toUpperCase().indexOf(n);if(i>=0){var s=document.createElement("span");s.className="highlight";var o=e.splitText(i);var u=o.splitText(n.length);var a=o.cloneNode(true);s.appendChild(a);o.parentNode.replaceChild(s,o);r=1}}else if(e.nodeType==1&&e.childNodes&&!/(script|style)/i.test(e.tagName)){for(var f=0;f<e.childNodes.length;++f){f+=t(e.childNodes[f],n)}}return r}return this.length&&e&&e.length?this.each(function(){t(this,e.toUpperCase())}):this}}if(typeof $.fn.removeHighlight!=="function"){jQuery.fn.removeHighlight=function(){var _normalize=function(e){var t=e.firstChild;while(t.nextSibling&&t.nextSibling.nodeType===3){if(t.nextSibling&&t.nextSibling.data){t.data+=t.nextSibling.data}t.parentNode.removeChild(t.nextSibling)}};return this.find("span.highlight").each(function(){var parent=this.parentNode;with(parent){replaceChild(this.firstChild,this);_normalize(parent)}}).end()}}$.fn.isScrollable=function(e){var t=new Array;this.each(function(n,r){var i,s;var o=!e||e==="vertical"||e==="y",u=e&&(e==="horizontal"||e==="x");if($(r).css("overflow")=="scroll"||$(r).css("overflowX")==="scroll"&&(u||!e)||$(r).css("overflowY")==="scroll"&&(o||!e)){t.push(true);return}if(o||!e){i=$.inArray($(r).css("overflowY"),["scroll","auto"])!==-1||$.inArray($(r).css("overflow"),["scroll","auto"])!==-1;if(!e){if(i){t.push(true);return}}else{t.push(i);return}}if(u||!e){s=$.inArray($(r).css("overflowX"),["scroll","auto"])!==-1||$.inArray($(r).css("overflow"),["scroll","auto"])!==-1;t.push(s)}});if(t.length===1){return t[0]}else{return t}}})(jQuery)
